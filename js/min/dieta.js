function pulsantePremuto(a){a.style.boxShadow="0 3px 18px -5px #000"}function pulsanteRilasciato(a){a.style.boxShadow="0 3px 8px -5px #000"}function mostraBlock(a){a.style.display="block"}function nascondiNone(a){a.style.display="none"}function eventPulsante(a,b,c){a.addEventListener(b,function(a){c(a.target)},!1)}function adPropsOggettoDaArrays(a,b,c){var d,e;if(Array.isArray(b)&&Array.isArray(c)&&b.length===c.length)for(var f=0;f<b.length;f++)d=b[f],e=c[f],a[d]=e}function showSuggerimento(a,b){suggerimento.style.display="block",suggerimento.innerHTML=a,this.hideSuggerimento=function(){suggerimento.style.display="none"},setTimeout("this.hideSuggerimento(this)",b)}function creaElementi(a,b,c){var d=document.createElement(a);if(b)for(var e in b)b.hasOwnProperty(e)&&d.setAttribute(e,b[e]);for(var f in c)c.hasOwnProperty(f)&&(d.style[f]=c[f]);for(var g=3;g<arguments.length;g++){var h=arguments[g];"string"==typeof h&&(h=document.createTextNode(h)),d.appendChild(h)}return d}function creaLista(a,b,c,d,e,f){var g=document.createElement("select");g.setAttribute("class",a);var h=document.createElement("option");h.value=0;var i=document.createTextNode(b);h.appendChild(i),g.appendChild(h);for(var j=c;j<d;j+=e){var k=document.createElement("option");k.value=j,k.textContent=j,g.appendChild(k)}return g.value=f,g}function oggettoPasto(a){var b=a.replace(/\s/g,"X"),c=b.replace(/'/g,"W");d=c;var d={};return d}function allarmeRosso(a,b,c){a>b?(c.style.background="red",c.style.color="white"):(c.style.background="",c.style.color="")}function azzeraValori(){for(var e,a=[1,2,3],b=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],c=[0,1,2],d=0;e=a[d];d++)macronutrienti.children[e].children[2].innerHTML=0;for(var f=0;f<b.length;f++)vitMin.children[f].children[2].innerHTML=0;for(var g=0;g<c.length;g++)alimentiAlcol.children[g].innerHTML=0;macronutrienti.children[4].children[2].innerHTML=0,macronutrienti.children[4].children[2].style.background=""}function impostaValore(a){var b=0,c=-4,d=-20;for(var e in a){b+=1,c+=1,d+=1,("carbo"===e||"proteine"===e||"grassi"===e)&&(macronutrienti.children[b].children[2].innerHTML=a[e].toFixed(0)),("fibre"===e||"sodio"===e||"potassio"===e||"calcio"===e||"fosforo"===e||"magnesio"===e)&&(vitMin.children[c].children[2].innerHTML=a[e].toFixed(0)),("ferro"===e||"zinco"===e||"b1"===e||"b2"===e||"b3"===e||"a"===e||"c"===e||"e"===e)&&(vitMin.children[c].children[2].innerHTML=a[e].toFixed(2)),("rame"===e||"selenio"===e)&&(vitMin.children[c].children[2].innerHTML=a[e].toFixed(3)),("birra"===e||"vinoBianco"===e||"vinoRosso"===e)&&(alimentiAlcol.children[d].innerHTML=a[e].toFixed(2));var f=macronutrienti.children[1].children[2].firstChild.nodeValue,g=macronutrienti.children[2].children[2].firstChild.nodeValue,h=macronutrienti.children[3].children[2].firstChild.nodeValue,i=parseFloat(alimentiAlcol.children[0].firstChild.nodeValue),j=parseFloat(alimentiAlcol.children[1].firstChild.nodeValue),k=parseFloat(alimentiAlcol.children[2].firstChild.nodeValue),l=9*h+4*g+4*f+i+j+k;macronutrienti.children[4].children[2].innerHTML=l.toFixed(0),allarmeRosso(l,mieCalorie,macronutrienti.children[4].children[2])}}function showRisultati(){var a=document.querySelectorAll("div.divPasto"),b=a.length,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y={};if(0===b)azzeraValori();else for(var z=0;z<a.length;z++){divPasto=a[z];var A=divPasto.children[2];c+=parseFloat(A.getAttribute("zmcarbo")),y.carbo=c,d+=parseFloat(A.getAttribute("zmproteine")),y.proteine=d,e+=parseFloat(A.getAttribute("zmgrassi")),y.grassi=e,f+=parseFloat(A.getAttribute("zmfibre")),y.fibre=f,g+=parseFloat(A.getAttribute("zmNa")),y.sodio=g,h+=parseFloat(A.getAttribute("zmK")),y.potassio=h,i+=parseFloat(A.getAttribute("zmFe")),y.ferro=i,j+=parseFloat(A.getAttribute("zmCa")),y.calcio=j,k+=parseFloat(A.getAttribute("zmP")),y.fosforo=k,l+=parseFloat(A.getAttribute("zmMg")),y.magnesio=l,m+=parseFloat(A.getAttribute("zmZn")),y.zinco=m,n+=parseFloat(A.getAttribute("zmCu")),y.rame=n,o+=parseFloat(A.getAttribute("zmSe")),y.selenio=o,p+=parseFloat(A.getAttribute("zmB1")),y.b1=p,q+=parseFloat(A.getAttribute("zmB2")),y.b2=q,r+=parseFloat(A.getAttribute("zmB3")),y.b3=r,s+=parseFloat(A.getAttribute("zmA")),y.a=s,t+=parseFloat(A.getAttribute("zmC")),y.c=t,u+=parseFloat(A.getAttribute("zmE")),y.e=u,v+=parseFloat(A.getAttribute("zmbirra")),y.birra=v,w+=parseFloat(A.getAttribute("zmvinoBianco")),y.vinoBianco=w,x+=parseFloat(A.getAttribute("zmvinoRosso")),y.vinoRosso=x}impostaValore(y)}function storePasti(a){a["class"]="valori-nutrienti",btnRiprendiDieta.style.display="none";var d,b=sessionStorage.getItem("pasto"),c=sessionStorage.getItem("NomeAlimento");d="colazione"===b?creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#fafaaa"}):"pranzo"===b?creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#ffbe88"}):"cena"===b?creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#aafaf5"}):creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#fff"});var e=creaElementi("span",null,{display:"none"},b),f=creaElementi("span",{},{display:"inline-block",width:"70%"},c),g=creaLista("porzioneGrammi","gr.",10,300,10,0),h=creaElementi("span",a,{display:"inline-block",width:"20%"},g),i=creaElementi("button",{"class":"annullaPasto"},{display:"inline-block",width:"8%"},"X");d.appendChild(e),d.appendChild(f),d.appendChild(h),d.appendChild(i),pastiScelti.appendChild(d),calcolaValori(),eliminaPasti()}function calcolaValori(){for(var b,c,i,d=(document.querySelectorAll("div.divPasto").length,0),e=0,f=0,g=document.querySelectorAll("select.porzioneGrammi"),h=0;i=g[h];h++)i.addEventListener("change",function(a){memDieta.style.display="block",io=a.target,b=io.value;for(var j,g=io.parentNode,h=g.attributes,i=0,k=0;i<h.length;i++)if(j=h[i].nodeName,k=parseFloat(h[i].nodeValue),"m"===j.charAt(0)){c=k*b/100;var l="z"+j;g.setAttribute(l,c),"mcarbo"===j&&(d=c),"mproteine"===j&&(e=c),"mgrassi"===j&&(f=c),setTimeout("showSuggerimento('Carboidrati: "+d+" - Proteine: "+e+" - Grassi: "+f+"',4000)",100)}showRisultati()},!1)}function eliminaPasti(){for(var c,a=document.querySelectorAll("button.annullaPasto"),b=0;c=a[b];b++)c.addEventListener("click",function(a){io=a.target;var b=io.parentNode;b.parentNode&&(b.parentNode.removeChild(b),showRisultati(!0))},!1)}function bevande(a,b){a.mbirra="birra chiara"===b?19:0,a.mvinoBianco="vino bianco"===b?70:0,a.mvinoRosso="vino rosso"===b?75:0}function loadAlimenti(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){for(var e,h,a=JSON.parse(c.responseText),d=["proteine","grassi","carbo","fibre","Na","K","Fe","Ca","P","Mg","Zn","Cu","Se","B1","B2","B3","A","C","E"],f={},g=0;h=a[g];g++){var i=h.nome;if(i===b)for(var k,j=0;k=d[j];j++){var l=h[k];e="m"+k,f[e]=l,bevande(f,b)}}storePasti(f),dragEdrop()}},c.open("GET",a,!0),c.send()}function alimentoCat(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.addEventListener("load",function(){c.status<400?b(c.responseText):b(null,new Error("Request failed: "+c.statusText))}),c.addEventListener("error",function(){b(null,new Error("Network error"))}),c.send(null)}function callback(a){for(var d,b=JSON.parse(a),c=0;d=b[c];c++){var e=d.replace(/\s/g,"-"),f=e.replace(/'/g,"@");alimentiDiCateg.innerHTML+='<button class="catAlimenti" id='+f+">"+d+"</button><br> "}for(var i,g=document.getElementsByClassName("catAlimenti"),h=0;i=g[h];h++)i.addEventListener("click",function(a){var b=a.target,d=(sessionStorage.getItem("pasto"),b.getAttribute("id").replace(/-/g," ")),e=d.replace(/@/,"'"),f=sessionStorage.getItem("categorieAlimenti");loadAlimenti("json/cat/"+f+".json",e),alimVegetariani.style.display="none",alimentiDiCateg.style.display="none",colPranzoCena.style.display="block",sessionStorage.setItem("NomeAlimento",e),setTimeout("showSuggerimento('Seleziona la quantit\xe0 in grammi',2000)",600),window.pageYOffset=0,document.documentElement.scrollTop=0,document.body.scrollTop=0,dragEdrop()},!1);document.location.href="#alimentiDiCateg"}function loadCat(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState&&200==c.status)for(var e,a=JSON.parse(c.responseText),d=0;e=a[d];d++)e===b&&alimentoCat("json/cat"+b+".json",callback)},c.open("GET",a,!0),c.send()}function storeListaPasti(a){var c,d=0,e={};for(i=0;i<a.length;i++){d++;var f=localStorage.getItem("pasto"+d),g=localStorage.getItem("alimento"+d),h=localStorage.getItem("grammi"+d);oggetto=a[i];for(var j in oggetto)c=oggetto[j],e[j]=c;var k;k="colazione"===f?creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#fafaaa"}):"pranzo"===f?creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#ffbe88"}):"cena"===f?creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#aafaf5"}):creaElementi("div",{"class":"divPasto",draggable:"true"},{background:"#fff"});var l=creaElementi("span",null,{display:"none"},f),m=creaElementi("span",{},{display:"inline-block",width:"70%"},g),n=creaLista("porzioneGrammi","gr.",10,300,10,h),o=creaElementi("span",e,{display:"inline-block",width:"20%"},n),p=creaElementi("button",{"class":"annullaPasto"},{display:"inline-block",width:"8%"},"X");k.appendChild(l),k.appendChild(m),k.appendChild(o),k.appendChild(p),pastiScelti.appendChild(k)}showRisultati(),calcolaValori(),eliminaPasti(),dragEdrop()}function dragEdrop(){for(var a=document.querySelectorAll("div.divPasto"),b=null,c=0;c<a.length;c++)a[c].addEventListener("dragstart",function(a){a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text",this.innerHTML),b=a.target}),a[c].addEventListener("dragend",function(){b=null});pastiScelti.addEventListener("dragover",function(a){return a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="move",!1});for(var c=0;c<a.length;c++)a[c].addEventListener("drop",function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation();var c=this.nextElementSibling,d=this.offsetTop,e=b.offsetTop;d>e?pastiScelti.insertBefore(b,c):pastiScelti.insertBefore(b,this)},!1)}var interrogativo=document.getElementById("int"),spiegaz=document.getElementById("spiegaz"),xInfo=document.getElementById("xInfo"),scuro=document.getElementById("scuro");eventPulsante(interrogativo,"mousedown",pulsantePremuto),eventPulsante(interrogativo,"mouseup",pulsanteRilasciato),interrogativo.addEventListener("click",function(){spiegaz.style.top=0,spiegaz.style.transition="top 300ms ease-out 200ms",setTimeout("mostraBlock(scuro);",500)},!1),xInfo.addEventListener("click",function(){setTimeout("nascondiNone(scuro);",500),spiegaz.style.top="-1000px",spiegaz.style.transition="top 500ms ease-in 200ms",interrogativo.style.display="block",interrogativo.style.display="flex"},!1);var acca1=document.getElementById("h1Dieta"),ceckCalorie=document.getElementById("ceckCalorie"),fabbisogniEnergetici=document.getElementById("fabbisogniEnergetici"),divoVV=document.getElementById("veganVegetariano"),colPranzoCena=document.getElementById("colPranzoCena"),alimVegetariani=document.querySelector("#alimVegetariani"),alimentiDiCateg=document.getElementById("alimentiDiCateg"),macronutrienti=document.getElementById("macronutrienti"),pastiScelti=document.getElementById("pastiScelti"),suggerimento=document.getElementById("suggerimento"),vitMin=document.getElementById("vitamine-minerali"),alimentiAlcol=document.getElementById("alimentiAlcol"),mostraFMV=document.getElementById("boxMmostraFVM"),memDieta=document.getElementById("memorizzaDieta"),btnCancellaDieta=document.getElementById("btnCancellaDieta"),btnDietaPausa=document.getElementById("btnDietaPausa"),btnRiprendiDieta=document.getElementById("btnRiprendiDieta"),eliminazioneDieta=document.getElementById("eliminazioneDieta"),confermaX=document.getElementById("confermaX"),annullaX=document.getElementById("annullaX"),etico=document.getElementById("btnVeganVeget"),n=0,elementDragged=null,mieCalorie=localStorage.getItem("mieCalorie");if(mieCalorie)ceckCalorie.style.display="none";else{fabbisogniEnergetici.style.display="none",macronutrienti.style.display="none",divoVV.style.display="none",mostraFMV.style.display="none";var df=document.createDocumentFragment(),codice=document.createElement("script");codice.type="text/javascript",codice.src="js/calcola_calorie_app.js",df.appendChild(codice),document.body.appendChild(df)}for(var needCarboidrati=(.65*mieCalorie/4).toFixed(0),needProteine=(.1*mieCalorie/4).toFixed(0),needGrassi=(.25*mieCalorie/9).toFixed(0),arrMacroNutrienti=[needCarboidrati,needProteine,needGrassi,mieCalorie],rda=0,valoreRDA;rda<arrMacroNutrienti.length;rda++)valoreRDA=rda+1,macronutrienti.children[valoreRDA].children[1].innerHTML=arrMacroNutrienti[rda];var afmv=["sodio","potassio","ferro","calcio","fosforo","magnesio","zinco","rame","selenio","vitB1","vitB2","vitB3","vitA","vitC","vitE"];vitMin.children[0].children[1].innerHTML=25;for(var v=0,vc,valFMV;v<afmv.length;v++)valFMV=localStorage.getItem(afmv[v]),vc=v+1,vitMin.children[vc].children[1].innerHTML=valFMV;mostraFMV.addEventListener("click",function(){var b=vitMin.style.display;"block"===b?(vitMin.style.display="none",this.innerHTML="Mostra minerali e vitamine"):(vitMin.style.display="block",this.innerHTML="Nascondi minerali e vitamine")},!1),etico.addEventListener("click",function(){fabbisogniEnergetici.style.display="none",acca1.style.display="none",divoVV.style.display="none",colPranzoCena.style.display="block",document.location.href="#colPranzoCena"},!1),colPranzoCena.addEventListener("click",function(a){var b=a.target;colPranzoCena.style.display="none",alimVegetariani.style.display="block";var c=b.getAttribute("id");sessionStorage.setItem("pasto",c),alimVegetariani.firstElementChild.innerHTML="Scegli gli alimenti per <b>"+c+"</b><br>",document.location.href="#alimVegetariani"},!1),alimVegetariani.addEventListener("click",function(a){alimentiDiCateg.style.display="block";var b=a.target,c=b.getAttribute("class").slice(1);sessionStorage.setItem("categorieAlimenti",c),document.querySelector("#alimentiDiCateg").innerHTML="",loadCat("json/catAlimenti.json",c)},!1);var xChiudiCatAlimenti=document.querySelector("div.xChiudiCatAlimenti");xChiudiCatAlimenti.addEventListener("click",function(){alimVegetariani.style.display="none",colPranzoCena.style.display="block",alimentiDiCateg.innerHTML=""},!1),btnDietaPausa.addEventListener("click",function(){localStorage.setItem("pausadieta","si");var a=pastiScelti.children,b=macronutrienti.children[4].children[2].firstChild.nodeValue;localStorage.setItem("kcal",b),localStorage.setItem("numPasti",a.length);for(var d,e,f,g,j,c=0,i=0;j=a[i];i++){c++;for(var m,k=["pasto"+c,"alimento"+c,"grammi"+c,"mproteine"+c,"mgrassi"+c,"mcarbo"+c,"mfibre"+c,"mNa"+c,"mK"+c,"mFe"+c,"mCa"+c,"mP"+c,"mMg"+c,"mZn"+c,"mCu"+c,"mSe"+c,"mB1"+c,"mB2"+c,"mB3"+c,"mA"+c,"mC"+c,"mE"+c,"mbirra"+c,"mvinoBianco"+c,"mvinoRosso"+c,"zmproteine"+c,"zmgrassi"+c,"zmcarbo"+c,"zmfibre"+c,"zmNa"+c,"zmK"+c,"zmFe"+c,"zmCa"+c,"zmP"+c,"zmMg"+c,"zmZn"+c,"zmCu"+c,"zmSe"+c,"zmB1"+c,"zmB2"+c,"zmB3"+c,"zmA"+c,"zmC"+c,"zmE"+c,"zmbirra"+c,"zmvinoBianco"+c,"zmvinoRosso"+c],l=0;m=k[l];l++)localStorage.removeItem(m);d=j.children[0].firstChild.nodeValue,localStorage.setItem("pasto"+c,d),e=j.children[1].firstChild.nodeValue,localStorage.setItem("alimento"+c,e),f=j.children[2].children[0].value,localStorage.setItem("grammi"+c,f),g=j.children[2];for(var p,n=g.attributes,o=0,q=0;o<n.length;o++)p=n[o].nodeName+c,q=parseFloat(n[o].nodeValue),"m"===p.charAt(0)&&localStorage.setItem(p,q),"z"===p.charAt(0)&&localStorage.setItem(p,q)}window.pageYOffset=0,document.documentElement.scrollTop=0,document.body.scrollTop=0,setTimeout("showSuggerimento('La dieta \xe8 stata messa in pausa. Puoi recuperarla, in seguito, cliccando su <ins>Riprendi dieta</ins>',3000)",600)},!1),btnRiprendiDieta.addEventListener("click",function(){this.style.display="none",acca1.style.display="none",fabbisogniEnergetici.style.display="none",memDieta.style.display="block";for(var b=(parseFloat(localStorage.getItem("kcal")),localStorage.getItem("numPasti")),c=["mproteine","mgrassi","mcarbo","mfibre","mna","mk","mfe","mca","mp","mmg","mzn","mcu","mse","mb1","mb2","mb3","ma","mc","me","mbirra","mvinobianco","mvinorosso"],d=["zmproteine","zmgrassi","zmcarbo","zmfibre","zmna","zmk","zmfe","zmca","zmp","zmmg","zmzn","zmcu","zmse","zmb1","zmb2","zmb3","zma","zmc","zme","zmbirra","zmvinobianco","zmvinorosso"],e=[],f=0,h=1;h<=b;h++){f++;for(var i={},j=0;j<c.length;j++){var k=c[j]+h,l=localStorage.getItem(k);i[c[j]]=l}for(var m=0;m<d.length;m++){var n=d[m]+h,o=localStorage.getItem(n);i[d[m]]=o}e.push(i)}storeListaPasti(e)},!1);var numeroPa=localStorage.getItem("numPasti"),pausadieta=localStorage.getItem("pausadieta");pausadieta&&numeroPa>0&&(btnRiprendiDieta.style.display="block",acca1.style.display="none",fabbisogniEnergetici.style.display="none"),btnCancellaDieta.addEventListener("click",function(){scuro.style.display="block",eliminazioneDieta.style.display="block",window.pageYOffset=document.documentElement.scrollTop=document.body.scrollTop=0},!1),annullaX.addEventListener("click",function(){scuro.style.display="none",eliminazioneDieta.style.display="none"},!1),confermaX.addEventListener("click",function(){scuro.style.display="none",eliminazioneDieta.style.display="none",memDieta.style.display="none",acca1.style.display="block",fabbisogniEnergetici.style.display="block";var a=document.querySelectorAll("div.divPasto"),b=a.length;localStorage.setItem("numPasti",0);for(var c=0,d=0;d<b;d++){pastiScelti.removeChild(a[d]),c++;for(var g,e=["pasto"+c,"alimento"+c,"grammi"+c,"mproteine"+c,"mgrassi"+c,"mcarbo"+c,"mfibre"+c,"mNa"+c,"mK"+c,"mFe"+c,"mCa"+c,"mP"+c,"mMg"+c,"mZn"+c,"mCu"+c,"mSe"+c,"mB1"+c,"mB2"+c,"mB3"+c,"mA"+c,"mC"+c,"mE"+c,"mbirra"+c,"mvinoBianco"+c,"mvinoRosso"+c,"zmproteine"+c,"zmgrassi"+c,"zmcarbo"+c,"zmfibre"+c,"zmNa"+c,"zmK"+c,"zmFe"+c,"zmCa"+c,"zmP"+c,"zmMg"+c,"zmZn"+c,"zmCu"+c,"zmSe"+c,"zmB1"+c,"zmB2"+c,"zmB3"+c,"zmA"+c,"zmC"+c,"zmE"+c,"zmbirra"+c,"zmvinoBianco"+c,"zmvinoRosso"+c],f=0;g=e[f];f++)localStorage.removeItem(g)}azzeraValori()},!1);
